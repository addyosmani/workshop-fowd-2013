define(["config"],function(e){function n(e){t=e,this.loadGapi()}var t;return _.extend(n.prototype,Backbone.Events),n.prototype.init=function(){function r(){gapi.client.setApiKey(e.apiKey),window.setTimeout(i,100)}function i(){gapi.auth.authorize({client_id:e.clientId,scope:e.scopes,immediate:!0},s)}function s(e){var r;e&&!e.error?(e.expires_in&&(r=(e.expires_in-300)*1e3,window.setTimeout(i,r)),t.views.auth.$el.hide(),$("#signed-in-container").show(),n.trigger("ready")):(e&&e.error&&console.log("Unable to sign in:",e.error),t.views.auth.$el.show())}var n=this;gapi.client.load("tasks","v1",function(){}),this.checkAuth=function(){gapi.auth.authorize({client_id:e.clientId,scope:e.scopes,immediate:!1},s)},r()},n.prototype.loadGapi=function(){var e=this;if(typeof gapi!="undefined")return this.init();require(["https://apis.google.com/js/client.js?onload=define"],function(){function t(){gapi&&gapi.client?e.init():window.setTimeout(t,100)}t()})},Backbone.sync=function(e,t,n){var r={},i;n=n||{};switch(t.url){case"tasks":r.task=t.get("id"),r.tasklist=t.get("tasklist");break;case"tasklists":r.tasklist=t.get("id")}switch(e){case"create":r.resource=t.toJSON(),i=gapi.client.tasks[t.url].insert(r),Backbone.gapiRequest(i,e,t,n);break;case"update":r.resource=t.toJSON(),i=gapi.client.tasks[t.url].update(r),Backbone.gapiRequest(i,e,t,n);break;case"delete":r.resource=t.toJSON(),i=gapi.client.tasks[t.url].delete(r),Backbone.gapiRequest(i,e,t,n);break;case"read":i=gapi.client.tasks[t.url].list(n.data),Backbone.gapiRequest(i,e,t,n)}},Backbone.gapiRequest=function(e,t,n,r){var i;e.execute(function(t){t.error?r.error&&r.error(n,t):r.success&&(t.items?i=t.items:i=t,r.success(n,i,!0,e))})},n});