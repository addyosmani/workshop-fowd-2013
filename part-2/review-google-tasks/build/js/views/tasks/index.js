define(["text!templates/tasks/index.html","views/tasks/task","views/tasks/edit","collections/tasks"],function(e,t,n,r){var i=Backbone.View.extend({tagName:"div",className:"row-fluid",template:_.template(e),events:{"submit .add-task":"addTask"},initialize:function(){this.children=[],this.collection.on("add",this.renderTask,this)},render:function(){this.$el.html(this.template());var e=this.$("#task-list"),t=this;return this.collection.fetch({data:{tasklist:this.model.get("id")},success:function(){t.collection.each(function(e){e.set("tasklist",t.model.get("id")),t.renderTask(e)})}}),this},addTask:function(){var e=this.$('input[name="title"]'),t=new this.collection.model({tasklist:this.model.get("id")}),n=this;return t.save({title:e.val()},{success:function(e){n.collection.add(e,{at:0})}}),e.val(""),!1},renderTask:function(e,n,r){var i=new t({model:e,parentView:this}),s=this.$("#task-list");r&&r.at===0?s.prepend(i.render().el):s.append(i.render().el),this.children.push(i)},editTask:function(e){this.taskEditView&&this.taskEditView.remove(),this.taskEditView=new n({model:e}),this.$("#selected-task").append(this.taskEditView.render().el)}});return i});